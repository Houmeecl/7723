import React, { useState, useEffect } from 'react';

function VerificationPage() {
  const [nfcData, setNfcData] = useState('');
  const [image, setImage] = useState(null);
  const [videoStream, setVideoStream] = useState(null);
  const [capturedPhoto, setCapturedPhoto] = useState(null);

  // Función para leer NFC
  const handleNfcRead = async () => {
    if ('NFC' in window) {
      try {
        const nfc = await navigator.nfc.requestNfc();
        const nfcTag = await nfc.read();
        const nfcData = await nfcTag.text();
        setNfcData(nfcData);
      } catch (error) {
        alert('Error al leer NFC: ' + error.message);
      }
    } else {
      alert('Web NFC no está disponible en este navegador.');
    }
  };

  // Función para iniciar la cámara
  const startCamera = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      setVideoStream(stream);
    } catch (err) {
      console.error('Error al acceder a la cámara: ', err);
    }
  };

  // Función para capturar la foto
  const capturePhoto = () => {
    const canvas = document.createElement('canvas');
    const videoElement = document.getElementById('video');
    const context = canvas.getContext('2d');
    canvas.width = videoElement.videoWidth;
    canvas.height = videoElement.videoHeight;
    context.drawImage(videoElement, 0, 0, canvas.width, canvas.height);
    const photoUrl = canvas.toDataURL('image/png');
    setCapturedPhoto(photoUrl);
  };

  useEffect(() => {
    startCamera();
  }, []);

  return (
    <div className="VerificationPage">
      <h1>Proceso de Verificación</h1>

      {/* Lectura NFC */}
      <div>
        <button onClick={handleNfcRead}>Leer NFC</button>
        <p>Datos NFC leídos: {nfcData}</p>
      </div>

      {/* Captura de foto */}
      <div>
        <video id="video" autoPlay></video>
        <button onClick={capturePhoto}>Capturar Foto</button>
        <canvas id="photo-preview" style={{ display: 'none' }}></canvas>
        {capturedPhoto && (
          <div>
            <h3>Foto capturada:</h3>
            <img src={capturedPhoto} alt="Foto Capturada" />
            {/* Aquí podrías enviar la foto para comparación con la foto del documento */}
          </div>
        )}
      </div>
    </div>
  );
}

export default VerificationPage;
